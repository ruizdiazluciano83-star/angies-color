{% extends "base.html" %}
{% block content %}

<div class="flex items-center justify-between mb-3">
  <div>
    <div class="text-zinc-400 text-[11px] tracking-widest mb-1">AGENDA</div>
    <div class="text-2xl font-semibold">Turnos</div>
  </div>

  <a href="/turnos/nuevo?date_str={{ selected_date }}"
     class="px-4 py-2 rounded-2xl font-semibold text-zinc-900 text-sm"
     style="background: var(--gold);">
    + Agendar
  </a>
</div>

{% if staff_list and staff_list|length > 0 %}
  <div class="flex gap-2 mb-4 overflow-x-auto pb-1">
    {% for s in staff_list %}
      <a href="/turnos?date_str={{ selected_date }}&staff_id={{ s.id }}"
         class="px-4 py-2 rounded-2xl border border-zinc-800 text-sm font-semibold whitespace-nowrap
         {% if s.id == staff_id %} bg-white/10 {% else %} bg-white/5 {% endif %}">
        {{ s.name|upper }}
      </a>
    {% endfor %}
  </div>
{% endif %}

<div class="rounded-2xl border border-zinc-800 bg-white/5 overflow-hidden mb-4">
  <div class="flex items-center justify-between px-4 py-3">
    <div class="font-semibold">{{ day_name }}</div>
    <div class="text-zinc-300">{{ date_label }}</div>
  </div>
</div>

<div class="rounded-3xl border border-zinc-800 bg-white/5 overflow-hidden">
  {% for row in grid %}
    {% if row.state == "free" %}
      <a href="/turnos/nuevo?date_str={{ selected_date }}&time_str={{ row.time_str }}"
         class="block px-4 py-3 border-b border-zinc-800/70">
        <div class="flex items-center justify-between">
          <div class="text-zinc-200 font-semibold">{{ row.time_str }} HS</div>
          <div class="text-green-400 font-bold text-sm">LIBRE</div>
        </div>
      </a>
    {% elif row.state == "blocked" %}
      <div class="px-4 py-3 border-b border-zinc-800/70 bg-red-900/20">
        <div class="flex items-center justify-between">
          <div class="text-zinc-300 font-semibold">{{ row.time_str }} HS</div>
          <div class="text-red-300 text-sm font-semibold">No disponible</div>
        </div>
      </div>
    {% else %}
      {% set a = row.appt %}
      <div class="px-4 py-3 border-b border-zinc-800/70">
        <div class="text-zinc-300 font-semibold">{{ row.time_str }} HS</div>

        <div class="mt-1 text-white font-semibold">
          {{ a.client.name if a.client else "CLIENTE" }} ·
          <span style="color: {{ a.specialty.color_hex if a.specialty else '#F5C542' }};">
            {{ a.specialty.name if a.specialty else "SERVICIO" }}
          </span>
          {% if a.deposit_paid %}
            <span class="ml-2 font-semibold" style="color:#38bdf8;">Seña ${{ a.deposit_amount }}</span>
          {% endif %}
        </div>

        <div class="text-zinc-400 text-sm mt-1">
          Duración {{ a.duration_min }}m
        </div>
      </div>
    {% endif %}
  {% endfor %}
</div>

{% endblock %}
