{% extends "base.html" %}
{% block content %}

<div class="mb-4">
  <div class="text-zinc-400 text-[11px] tracking-widest mb-1">AGENDA</div>
  <div class="flex items-center justify-between gap-3">
    <div class="text-2xl font-semibold">Turnos</div>

    <a href="/turnos/nuevo?date_str={{ selected_date }}&time_str=&staff_id={{ staff_id }}&salon={{ salon }}"
       class="px-4 py-2 rounded-2xl font-bold text-zinc-900 text-sm"
       style="background: var(--gold);">
      + Agendar
    </a>
  </div>
</div>

<!-- STAFF + SALON -->
<div class="card p-3 mb-4 flex flex-wrap items-center justify-between gap-3">
  <div class="flex flex-wrap gap-2">
    {% for st in staffs %}
      <a class="pill {% if st.id == staff_id %}active{% endif %}"
         href="/turnos?date_str={{ selected_date }}&staff_id={{ st.id }}&salon={{ salon }}">
        {{ st.name }}
      </a>
    {% endfor %}
  </div>

  <div class="flex items-center gap-2">
    <div class="text-zinc-300 text-sm font-bold">SALÓN</div>
    <a class="pill {% if salon == 1 %}active{% endif %}"
       href="/turnos?date_str={{ selected_date }}&staff_id={{ staff_id }}&salon=1">1</a>
    <a class="pill {% if salon == 2 %}active{% endif %}"
       href="/turnos?date_str={{ selected_date }}&staff_id={{ staff_id }}&salon=2">2</a>
  </div>
</div>

<!-- DÍA + FECHA (por ahora visual) -->
<div class="card p-4 mb-4 flex items-center justify-between">
  <div class="font-extrabold text-xl">{{ selected_weekday }}</div>
  <div class="text-zinc-300 font-bold">{{ selected_date_label }}</div>
</div>

<!-- LISTA DE SLOTS -->
<div class="card overflow-hidden">
  {% for hhmm in slots %}
    {% set st = slot_state[hhmm] %}
    {% if st.kind == "FREE" %}
      <a href="/turnos/nuevo?date_str={{ selected_date }}&time_str={{ hhmm }}&staff_id={{ staff_id }}&salon={{ salon }}"
         class="block px-4 py-3 border-b border-zinc-800/70 hover:bg-white/5">
        <div class="flex items-center justify-between">
          <div class="font-bold">{{ hhmm }}</div>
          <div class="font-extrabold text-green-400">LIBRE</div>
        </div>
        <div class="text-xs text-zinc-400 mt-1">Disponible</div>
      </a>

    {% elif st.kind == "BLOCKED" %}
      <div class="px-4 py-3 border-b border-zinc-800/70 bg-white/2">
        <div class="flex items-center justify-between">
          <div class="font-bold">{{ hhmm }}</div>
          <div class="font-extrabold text-zinc-400">No disponible</div>
        </div>
        <div class="text-xs text-zinc-500 mt-1">
          Ocupado por turno de {{ st.owner_start }} a {{ st.owner_end }}
        </div>
      </div>

    {% elif st.kind == "APPT" %}
      {% set a = st.appt %}
      <a href="/turnos/{{ a.id }}/editar"
         class="block px-4 py-3 border-b border-zinc-800/70 hover:bg-white/5">
        <div class="flex items-start justify-between gap-3">
          <div>
            <div class="font-bold">{{ hhmm }} · {{ a.client.name }}</div>
            <div class="text-sm mt-1">
              {% if a.specialty %}
                <span class="font-extrabold" style="color: {{ a.specialty.color_hex }}">{{ a.specialty.name }}</span>
              {% endif %}
              <span class="text-zinc-300"> · {{ a.duration_min }} min</span>
              {% if a.deposit_paid and a.deposit_amount %}
                <span class="text-zinc-300"> · Seña ${{ a.deposit_amount }}</span>
              {% endif %}
            </div>
          </div>

          <!-- WhatsApp icon (solo visual acá; tu lógica WA ya la tenés con endpoints) -->
          <div class="shrink-0">
            <div class="h-10 w-10 rounded-2xl border border-zinc-700 bg-black/30 flex items-center justify-center">
              <span class="text-green-400 font-black">WA</span>
            </div>
          </div>
        </div>
      </a>
    {% endif %}
  {% endfor %}
</div>

{% endblock %}
