{% extends "base.html" %}
{% block content %}

<div class="mb-3">
  <div class="text-zinc-400 text-[11px] tracking-widest mb-1">TURNO</div>
  <h2 class="text-lg font-semibold">Editar turno</h2>
  {% if error %}
    <div class="mt-2 text-sm font-semibold text-red-300">{{ error }}</div>
  {% endif %}
</div>

<form method="post" action="/turnos/{{ appt.id }}/editar" class="space-y-3">

  <div>
    <label class="block text-xs text-zinc-400 mb-1">Fecha</label>
    <input type="date" name="fecha" required value="{{ appt.date.strftime('%Y-%m-%d') }}"
      class="w-full px-4 py-3 rounded-2xl bg-zinc-900/60 border border-zinc-800 text-sm">
  </div>

  <div>
    <label class="block text-xs text-zinc-400 mb-1">Hora</label>
    <input type="time" name="hora" required value="{{ appt.start_time.strftime('%H:%M') }}"
      class="w-full px-4 py-3 rounded-2xl bg-zinc-900/60 border border-zinc-800 text-sm">
  </div>

  <div>
    <label class="block text-xs text-zinc-400 mb-1">Cliente</label>
    <select name="client_id" required
      class="w-full px-4 py-3 rounded-2xl bg-zinc-900/60 border border-zinc-800 text-sm">
      {% for c in clients %}
        <option value="{{ c.id }}" {% if c.id == appt.client_id %}selected{% endif %}>{{ c.name }}</option>
      {% endfor %}
    </select>
  </div>

  <div>
    <label class="block text-xs text-zinc-400 mb-1">Trabajo</label>
    <select name="specialty_id" required
      class="w-full px-4 py-3 rounded-2xl bg-zinc-900/60 border border-zinc-800 text-sm">
      {% for s in specialties %}
        <option value="{{ s.id }}" {% if s.id == appt.specialty_id %}selected{% endif %}>{{ s.name }}</option>
      {% endfor %}
    </select>
  </div>

  <div>
    <label class="block text-xs text-zinc-400 mb-1">Duraci칩n</label>
    <input type="number" name="duration_min" min="30" step="30" required value="{{ appt.duration_min }}"
      class="w-full px-4 py-3 rounded-2xl bg-zinc-900/60 border border-zinc-800 text-sm">
  </div>

  <div>
    <label class="block text-xs text-zinc-400 mb-1">Staff</label>
    <select name="staff_id"
      class="w-full px-4 py-3 rounded-2xl bg-zinc-900/60 border border-zinc-800 text-sm">
      <option value="0" {% if not appt.staff_id %}selected{% endif %}>Sin asignar</option>
      {% for p in staff %}
        <option value="{{ p.id }}" {% if appt.staff_id == p.id %}selected{% endif %}>{{ p.name }}</option>
      {% endfor %}
    </select>
  </div>

  <div>
    <label class="block text-xs text-zinc-400 mb-1">Estado</label>
    <select name="status"
      class="w-full px-4 py-3 rounded-2xl bg-zinc-900/60 border border-zinc-800 text-sm">
      <option value="CONFIRMADO" {% if appt.status=="CONFIRMADO" %}selected{% endif %}>Confirmado</option>
      <option value="CANCELADO" {% if appt.status=="CANCELADO" %}selected{% endif %}>Cancelado</option>
    </select>
  </div>

  <div class="rounded-2xl border border-zinc-800 bg-white/5 backdrop-blur-xl p-4">
    <label class="flex items-center gap-2 text-sm font-semibold text-zinc-200">
      <input id="depositChk" type="checkbox" name="deposit_paid" class="w-4 h-4" {% if appt.deposit_paid %}checked{% endif %}>
      Dej칩 se침a
    </label>
    <div id="depositBox" class="{% if appt.deposit_paid %}mt-2{% else %}hidden mt-2{% endif %}">
      <input type="number" name="deposit_amount" min="0" value="{{ appt.deposit_amount }}"
        placeholder="Monto de se침a ($)"
        class="w-full px-4 py-3 rounded-2xl bg-zinc-900/60 border border-zinc-800 text-sm">
    </div>
  </div>

  <button type="submit"
    class="w-full mt-2 py-3 rounded-2xl text-sm font-semibold text-zinc-900"
    style="background: var(--gold);">
    Guardar cambios
  </button>

</form>

<script>
  const chk = document.getElementById("depositChk");
  const box = document.getElementById("depositBox");
  chk.addEventListener("change", () => {
    if (chk.checked) box.classList.remove("hidden");
    else box.classList.add("hidden");
  });
</script>

{% endblock %}
