{% extends "base.html" %}
{% block content %}

<div class="mb-4">
  <div class="text-zinc-400 text-[11px] tracking-widest mb-1">TURNOS</div>
  <div class="text-2xl font-semibold">Nuevo turno</div>
</div>

<form method="post" action="/turnos/nuevo" class="card p-4 space-y-3">

  <div class="grid grid-cols-2 gap-3">
    <div>
      <div class="text-[11px] tracking-widest text-zinc-400 mb-2">FECHA</div>
      <input name="date_str" type="date" value="{{ date_str }}"
             class="w-full px-4 py-3 rounded-2xl bg-black/30 border border-zinc-800 text-white" required>
    </div>

    <div>
      <div class="text-[11px] tracking-widest text-zinc-400 mb-2">HORA</div>
      <input name="time_str" value="{{ time_str }}" placeholder="HH:MM (ej 09:30)"
             class="w-full px-4 py-3 rounded-2xl bg-black/30 border border-zinc-800 text-white" required>
    </div>
  </div>

  <div class="grid grid-cols-2 gap-3">
    <div>
      <div class="text-[11px] tracking-widest text-zinc-400 mb-2">STAFF</div>
      <select name="staff_id" class="w-full px-4 py-3 rounded-2xl bg-black/30 border border-zinc-800 text-white">
        <option value="0">—</option>
        {% for s in staff %}
          <option value="{{ s.id }}" {% if s.id == staff_id %}selected{% endif %}>{{ s.name }}</option>
        {% endfor %}
      </select>
    </div>

    <div>
      <div class="text-[11px] tracking-widest text-zinc-400 mb-2">SALÓN</div>
      <select name="salon" class="w-full px-4 py-3 rounded-2xl bg-black/30 border border-zinc-800 text-white">
        <option value="1" {% if salon == 1 %}selected{% endif %}>Salón 1</option>
        <option value="2" {% if salon == 2 %}selected{% endif %}>Salón 2</option>
      </select>
    </div>
  </div>

  <div>
    <div class="text-[11px] tracking-widest text-zinc-400 mb-2">CLIENTE (buscar / elegir)</div>
    <input id="csearch" placeholder="Buscar por nombre o teléfono…"
           class="w-full px-4 py-3 rounded-2xl bg-black/30 border border-zinc-800 text-white mb-3">
    <select id="clientSel" name="client_id" class="w-full px-4 py-3 rounded-2xl bg-black/30 border border-zinc-800 text-white">
      <option value="0">Crear nuevo (abajo)</option>
      {% for c in clients %}
        <option value="{{ c.id }}" data-name="{{ c.name }}" data-phone="{{ c.phone }}">{{ c.name }}{% if c.phone %} ({{ c.phone }}){% endif %}</option>
      {% endfor %}
    </select>
  </div>

  <div id="newClientBox" class="space-y-3">
    <div class="grid grid-cols-2 gap-3">
      <div>
        <div class="text-[11px] tracking-widest text-zinc-400 mb-2">NOMBRE</div>
        <input name="new_name" id="newName" placeholder="Nombre y apellido"
               class="w-full px-4 py-3 rounded-2xl bg-black/30 border border-zinc-800 text-white">
      </div>
      <div>
        <div class="text-[11px] tracking-widest text-zinc-400 mb-2">TELÉFONO</div>
        <input name="new_phone" id="newPhone" placeholder="11xxxxxxxx"
               class="w-full px-4 py-3 rounded-2xl bg-black/30 border border-zinc-800 text-white">
      </div>
    </div>
  </div>

  <div>
    <div class="text-[11px] tracking-widest text-zinc-400 mb-2">TRABAJO</div>
    <select name="specialty_id" class="w-full px-4 py-3 rounded-2xl bg-black/30 border border-zinc-800 text-white">
      <option value="0">—</option>
      {% for sp in specialties %}
        <option value="{{ sp.id }}">{{ sp.name }}</option>
      {% endfor %}
    </select>
  </div>

  <!-- DURACIÓN (queda sola en la fila) -->
  <div>
    <div class="text-[11px] tracking-widest text-zinc-400 mb-2">DURACIÓN (min)</div>
    <select name="duration_min" class="w-full px-4 py-3 rounded-2xl bg-black/30 border border-zinc-800 text-white">
      {% for m in [30,60,90,120,150,180,210,240] %}
        <option value="{{ m }}" {% if m == 30 %}selected{% endif %}>{{ m }}</option>
      {% endfor %}
    </select>
  </div>

  <!-- SEÑA (ABAJO, ancho completo, no estira pantalla) -->
  <div>
    <div class="text-[11px] tracking-widest text-zinc-400 mb-2">SEÑA (opcional)</div>
    <div class="space-y-2">
      <label class="flex items-center gap-2 px-3 py-3 rounded-2xl bg-black/30 border border-zinc-800">
        <input type="checkbox" name="deposit_paid" value="1">
        <span class="text-sm font-bold">Dejó seña</span>
      </label>

      <input name="deposit_amount" type="number" min="0" placeholder="$"
             class="w-full px-4 py-3 rounded-2xl bg-black/30 border border-zinc-800 text-white">
    </div>
  </div>

  <div>
    <div class="text-[11px] tracking-widest text-zinc-400 mb-2">NOTAS</div>
    <textarea name="notes" rows="3" placeholder="Notas del turno…"
              class="w-full px-4 py-3 rounded-2xl bg-black/30 border border-zinc-800 text-white"></textarea>
  </div>

  <button class="w-full py-3 rounded-2xl font-extrabold text-zinc-900" style="background: var(--gold);">
    Guardar turno
  </button>
</form>

<script>
  const search = document.getElementById("csearch");
  const sel = document.getElementById("clientSel");
  const newBox = document.getElementById("newClientBox");
  const newName = document.getElementById("newName");
  const newPhone = document.getElementById("newPhone");

  function toggleNew(){
    const v = parseInt(sel.value || "0", 10);
    if(v > 0){
      newBox.style.display = "none";
      newName.value = "";
      newPhone.value = "";
    }else{
      newBox.style.display = "block";
    }
  }
  sel.addEventListener("change", toggleNew);
  toggleNew();

  search.addEventListener("input", () => {
    const q = (search.value || "").toLowerCase();
    [...sel.options].forEach((opt, idx) => {
      if(idx === 0) return;
      const txt = (opt.textContent || "").toLowerCase();
      opt.hidden = q && !txt.includes(q);
    });
  });
</script>

{% endblock %}
